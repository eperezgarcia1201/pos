import { useEffect, useState } from "react";
import { AppLanguage, getCurrentLanguage, subscribeLanguageChange } from "./session";

type Dictionary = Record<string, string>;

const en: Dictionary = {
  language: "Language",
  english: "English",
  spanish: "Spanish",
  no_user: "No user",
  switch: "Switch",
  online: "Online",
  offline: "Offline",
  exit: "Exit",
  station: "Station {{value}}",
  main_screen: "Main Screen",
  back_to_previous_screen: "Back to previous screen",
  enter_access_code: "Enter Access Code",
  tap_digits_to_enter: "Tap digits to enter",
  invalid_access_code: "Invalid access code.",
  server_offline_start_backend: "Server offline. Start backend at {{url}}.",
  cashier_in: "Cashier In",
  cashier_out: "Cashier Out",
  tile_dine_in: "Dine In",
  tile_hostess: "Hostess",
  tile_take_out: "Take Out",
  tile_delivery: "Delivery",
  tile_recall: "Recall",
  tile_online_orders: "Online Orders",
  tile_void: "Void",
  tile_refund: "Refund",
  tile_kitchen: "Kitchen",
  tile_expo: "Expo",
  tile_owner: "Owner",
  tile_operations: "Operations",
  tile_time_cards: "Time Cards",
  tile_back_office: "Back Office",
  back_office: "Back Office",
  menu_file: "File",
  menu_setup: "Setup",
  menu_activities: "Activities",
  menu_reports: "Reports",
  menu_help: "Help",
  menu_online_orders: "Online Orders",
  store_settings: "Store Settings",
  security_settings: "Security Settings",
  station_settings: "Station Settings",
  table_setup: "Table Setup",
  kitchen_display: "Kitchen Display",
  data_source: "Data Source",
  payments_settings: "Payments",
  pay_employees: "Pay Employees",
  in_house_charge_accounts: "In House Charge Accounts",
  receive_inventory_items: "Receive Inventory Items",
  backup_database: "Backup Database",
  compact_database: "Compact Database",
  exit_program: "Exit Program",
  backup_not_performed: "Backup was not performed",
  last_backup: "Last Backup: {{value}}",
  data_source_unavailable: "Data source: unavailable",
  data_source_label: "Data Source: {{database}}@{{host}}",
  last_sync: "Last Sync: {{value}}",
  training_mode: "Training Mode",
  import_export_data: "Import/Export Data",
  import_new_resource_database: "Import New Resource Database",
  return_to_pos: "Return To POS",
  general_settings: "General Settings",
  employee_setup: "Employee Setup",
  menu_setup_item: "Menu Setup",
  menu_categories: "Menu Categories...",
  pizza_builder_setup: "Pizza Builder Setup...",
  modifier_builder_setup: "Modifier Builder Setup...",
  menu_groups: "Menu Groups...",
  menu_items: "Menu Items...",
  menu_item_auto_prices: "Menu Item Auto Prices...",
  menu_modifiers: "Menu Modifiers...",
  forced_modifiers: "Forced Modifiers...",
  inventory_setup: "Inventory Setup",
  kitchen_display_menu: "Kitchen Display...",
  expo_screen: "Expo Screen...",
  general_activities: "General Activities",
  customer_activities: "Customer Activities",
  inventory_activities: "Inventory Activities",
  maintenance_activities: "Maintenance Activities",
  third_party_add_ins: "Third Party Add-Ins",
  daily_sales: "Daily Sales",
  server_gratuity: "Server Gratuity",
  open_orders: "Open Orders",
  sales_per_item: "Sales Per Item",
  sales_per_category: "Sales Per Category",
  filter_by_month: "Filter by Month",
  support: "Support",
  server_connection_guide: "Server Connection Guide",
  user_manual: "System Manual",
  about: "About",
  order_feed: "Order Feed",
  integration_settings: "Integration Settings",
  change_station_type: "Change Station Type",
  manager_pin_change_station_type: "Manager PIN To Change Station Type"
};

const es: Dictionary = {
  language: "Idioma",
  english: "Ingles",
  spanish: "Espanol",
  no_user: "Sin usuario",
  switch: "Cambiar",
  online: "En linea",
  offline: "Sin conexion",
  exit: "Salir",
  station: "Estacion {{value}}",
  main_screen: "Pantalla principal",
  back_to_previous_screen: "Volver a la pantalla anterior",
  enter_access_code: "Ingrese codigo de acceso",
  tap_digits_to_enter: "Toque digitos para ingresar",
  invalid_access_code: "Codigo de acceso invalido.",
  server_offline_start_backend: "Servidor desconectado. Inicie backend en {{url}}.",
  cashier_in: "Apertura de caja",
  cashier_out: "Corte de caja",
  tile_dine_in: "Comer aqui",
  tile_hostess: "Hostess",
  tile_take_out: "Para llevar",
  tile_delivery: "Entrega",
  tile_recall: "Recuperar",
  tile_online_orders: "Ordenes en linea",
  tile_void: "Anular",
  tile_refund: "Reembolso",
  tile_kitchen: "Cocina",
  tile_expo: "Expo",
  tile_owner: "Dueno",
  tile_operations: "Operaciones",
  tile_time_cards: "Tarjetas de tiempo",
  tile_back_office: "Back Office",
  back_office: "Back Office",
  menu_file: "Archivo",
  menu_setup: "Configuracion",
  menu_activities: "Actividades",
  menu_reports: "Reportes",
  menu_help: "Ayuda",
  menu_online_orders: "Ordenes en linea",
  store_settings: "Configuracion de tienda",
  security_settings: "Configuracion de seguridad",
  station_settings: "Configuracion de estacion",
  table_setup: "Configuracion de mesas",
  kitchen_display: "Pantalla de cocina",
  data_source: "Fuente de datos",
  payments_settings: "Pagos",
  pay_employees: "Pagar empleados",
  in_house_charge_accounts: "Cuentas de cargo interno",
  receive_inventory_items: "Recibir inventario",
  backup_database: "Respaldar base de datos",
  compact_database: "Compactar base de datos",
  exit_program: "Salir del programa",
  backup_not_performed: "No se ha realizado respaldo",
  last_backup: "Ultimo respaldo: {{value}}",
  data_source_unavailable: "Fuente de datos: no disponible",
  data_source_label: "Fuente de datos: {{database}}@{{host}}",
  last_sync: "Ultima sincronizacion: {{value}}",
  training_mode: "Modo de entrenamiento",
  import_export_data: "Importar/Exportar datos",
  import_new_resource_database: "Importar nueva base de recursos",
  return_to_pos: "Volver al POS",
  general_settings: "Configuracion general",
  employee_setup: "Configuracion de empleados",
  menu_setup_item: "Configuracion de menu",
  menu_categories: "Categorias de menu...",
  pizza_builder_setup: "Configuracion de pizzas...",
  modifier_builder_setup: "Configuracion de modificadores...",
  menu_groups: "Grupos de menu...",
  menu_items: "Articulos de menu...",
  menu_item_auto_prices: "Precios automaticos...",
  menu_modifiers: "Modificadores de menu...",
  forced_modifiers: "Modificadores forzados...",
  inventory_setup: "Configuracion de inventario",
  kitchen_display_menu: "Pantalla de cocina...",
  expo_screen: "Pantalla de expo...",
  general_activities: "Actividades generales",
  customer_activities: "Actividades de clientes",
  inventory_activities: "Actividades de inventario",
  maintenance_activities: "Actividades de mantenimiento",
  third_party_add_ins: "Complementos de terceros",
  daily_sales: "Ventas diarias",
  server_gratuity: "Propinas por mesero",
  open_orders: "Ordenes abiertas",
  sales_per_item: "Ventas por articulo",
  sales_per_category: "Ventas por categoria",
  filter_by_month: "Filtrar por mes",
  support: "Soporte",
  server_connection_guide: "Guia de conexion de servidores",
  user_manual: "Manual del sistema",
  about: "Acerca de",
  order_feed: "Flujo de ordenes",
  integration_settings: "Configuracion de integracion",
  change_station_type: "Cambiar tipo de estacion",
  manager_pin_change_station_type: "PIN de gerente para cambiar tipo de estacion"
};

const dictionaries: Record<AppLanguage, Dictionary> = { en, es };

export function localeForLanguage(language: AppLanguage) {
  return language === "es" ? "es-US" : "en-US";
}

export function t(
  key: string,
  language: AppLanguage = getCurrentLanguage(),
  params?: Record<string, string | number>
) {
  const template = dictionaries[language][key] ?? dictionaries.en[key] ?? key;
  if (!params) return template;
  return Object.entries(params).reduce((acc, [param, value]) => {
    return acc.replaceAll(`{{${param}}}`, String(value));
  }, template);
}

export function useAppLanguage() {
  const [language, setLanguage] = useState<AppLanguage>(() => getCurrentLanguage());

  useEffect(() => {
    setLanguage(getCurrentLanguage());
    return subscribeLanguageChange((next) => setLanguage(next));
  }, []);

  return language;
}
